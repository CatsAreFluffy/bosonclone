<html>
	<head>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="three.min.js"></script>
		<script>
			function platformColor(){
				var temp=Math.random()
				if(temp<0.2){
					return color_blue
				}else{
					return color_normal
				}
			}
			function platGeometry(len,height){
				var geon=new THREE.Geometry()
				const stretch=0.166666
				const size=0.5
				geon.vertices.push(new THREE.Vector3(stretch*height,-height,0))          //000
				geon.vertices.push(new THREE.Vector3(-stretch*height,-height,0))         //001
				geon.vertices.push(new THREE.Vector3(stretch*(height+1),-height-size,0))    //010
				geon.vertices.push(new THREE.Vector3(-stretch*(height+1),-height-size,0))   //011
				geon.vertices.push(new THREE.Vector3(stretch*height,-height,len))        //100
				geon.vertices.push(new THREE.Vector3(-stretch*height,-height,len))       //101
				geon.vertices.push(new THREE.Vector3(stretch*(height+1),-height-size,len))  //110
				geon.vertices.push(new THREE.Vector3(-stretch*(height+1),-height-size,len)) //111
				geon.verticesNeedUpdate=true
				geon.faces.push(new THREE.Face3(2,1,0))
				geon.faces.push(new THREE.Face3(1,2,3))

				geon.faces.push(new THREE.Face3(4,5,6))
				geon.faces.push(new THREE.Face3(7,6,5))

				geon.faces.push(new THREE.Face3(0,1,4))
				geon.faces.push(new THREE.Face3(5,4,1))

				geon.faces.push(new THREE.Face3(2,3,6))
				geon.faces.push(new THREE.Face3(7,6,3))

				geon.faces.push(new THREE.Face3(4,2,0))
				geon.faces.push(new THREE.Face3(2,4,6))

				geon.faces.push(new THREE.Face3(1,3,5))
				geon.faces.push(new THREE.Face3(7,5,3))

				geon.elementsNeedUpdate=true
				geon.computeBoundingSphere()
				geon.computeFaceNormals();
				geon.computeVertexNormals();
				return geon
			}
			const plat_len = 2
			const plat_count = 16
			const ring_size = 10

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			//var geometry = new THREE.BoxGeometry( 1.2, 0.2, plat_len );
			var geometry=platGeometry(plat_len+0.01,6)
			var color_normal = new THREE.MeshPhongMaterial( { color: 0xbfbfbf } );
			color_normal.shading=THREE.FlatShading
			var color_blue = new THREE.MeshStandardMaterial( { color: 0x5fdfff } );
			//var cube = new THREE.Mesh( geometry, material );
			//scene.add( cube );

			var center=new THREE.Object3D()
			center.position.y=1.5
			scene.add(center)
			var spinners=[]
			var cubes=[]
			for(var i=0;i<plat_count;i++){
				cubes.push([])
				spinners.push([])
				for(var j=0;j<ring_size;j++){
					cubes[i].push(new THREE.Mesh(geometry,platformColor()))
					cubes[i][j].position.y=3
					cubes[i][j].position.z=-plat_len*i
					spinners[i].push(new THREE.Object3D())
					spinners[i][j].rotation.z=Math.PI*2/ring_size*j
					center.add(spinners[i][j])
					spinners[i][j].add(cubes[i][j])
				}
			}

			var player_geon=new THREE.BoxGeometry(0.5,0.5,0.5)
			var player_mat=new THREE.MeshPhongMaterial( { color: 0xff0000 } );
			var player=new THREE.Mesh(player_geon,player_mat)
			player.position.y=-1
			player.position.z=2
			scene.add(player)

			const brightness=0xcfcfcf
			var light = new THREE.AmbientLight( brightness );
			scene.add( light );
			/*var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
			scene.add( directionalLight );*/
			/*var spotLight=new THREE.PointLight(0xffffff,1,0,1)
			spotLight.position.set(0,2,0)
			scene.add(spotLight)*/

			camera.position.z = 5;

			var speed=0.05
			var player_y=-1

			var render = function () {
				requestAnimationFrame( render );
				for(var i=0;i<cubes.length;i++){
					for(var j=0;j<cubes[i].length;j++){
						cubes[i][j].position.z+=speed
						if(cubes[i][j].position.z>8){
							cubes[i][j].position.z-=plat_len*plat_count
							cubes[i][j].material=platformColor()
						}
					}
				}
				renderer.render(scene, camera);
				speed+=0.001
			};

			render();
		</script>
	</body>
</html>